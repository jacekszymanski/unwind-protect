# unwind-protect, or try/finally for Haxe

Haxe lacks ```finally``` in its ```try``` expression, hence this library.

It does the best to ensure that the cleanup expression (which may obviously be
a block) will be executed **exactly once** upon leaving, by whatever means
the protected expression. So far, it allows the protected expression to include
```return```, ```break``` and ```continue``` statements as well as loops and
local functions, which may be generated by other macros.

This library does not extend ```try``` syntax, but
introduces its own operator and syntax
for this purpose.

The library's name is also inspired by the 
```UNWIND-PROTECT``` operator
[found](http://www.lispworks.com/documentation/lw50/CLHS/Body/s_unwind.htm#unwind-protect) in Common Lisp.


## Usage:

## Build macro:

```
#!haxe

@protect {
  protected: PROT,
  cleanup: CLEAN
}

```

```CLEAN``` will **always** be executed when ```PROT``` exits. This includes normal completion or an abrupt exit with an exception, or a ```return```, ```break``` or ```continue``` statement.

To use ```@protect``` the class _must_ implement the ```net.parensoft.protect.ProtectSyntax``` interface or be annotated with ```@:build(net.parensoft.protect.ProtectSyntax.SyntaxBuilder.build())```

## Expression macro:

```
#!haxe
import net.parensoft.protect.Protect;

....

Protect.protect(
  PROT,
  CLEAN);
```

As above, ```CLEAN``` is executed always whenever ```PROT``` exits.

## Known limitations

Value of the ```@protected``` expression is undefined.

## Changes:

09/22/14: 0.2.0 Expand macros inside the protected block

09/22/08: 0.1.0 First version, support return, break, continue
inside the protected block.

## Todo:

* Scope exit
* Autoclose, like ```@autoclose var file = File.read(path)```

### License: MIT

(C) Parensoft.NET 2014
